package com.simon.video;import android.app.Activity;import android.content.SharedPreferences;import android.media.AudioManager.OnAudioFocusChangeListener;import android.media.MediaPlayer;import android.media.MediaPlayer.OnPreparedListener;import android.net.Uri;import android.os.Bundle;import android.view.KeyEvent;import android.widget.MediaController;import android.widget.VideoView;public class VideoActivity extends Activity implements		OnAudioFocusChangeListener {	private MediaPlayer myMediaPlayer;	private static final String TAG = "MusicActivity";	private String path;	private String type;	private MediaController controller;	@Override	public void onCreate(Bundle savedInstanceState) {		super.onCreate(savedInstanceState);		setContentView(R.layout.video);		myMediaPlayer = new MediaPlayer();		path = (String) getIntent().getSerializableExtra("path");		type = (String) getIntent().getSerializableExtra("type");		findView();		controller = new MediaController(this);		controller.show(0);		if (type.equals("local"))			playMusic();		else if (type.equals("remote"))			prepareMusicAsynchronous();	}	void findView() {		ViewHolder.videoWindow = (VideoView) findViewById(R.id.videoWindow);	}	void playMusic() {		ViewHolder.videoWindow.setMediaController(controller);		ViewHolder.videoWindow.setVideoURI(Uri.parse(path));		ViewHolder.videoWindow.requestFocus();		ViewHolder.videoWindow.start();	}	/*	 * use Asynchronous preparation	 */	void prepareMusicAsynchronous() {		VideoView videoView = ViewHolder.videoWindow;		videoView.setMediaController(controller);		if (videoView.isPlaying()) {			videoView.stopPlayback();		}		try {			//TODO used for test//			path =  "http://players.edgesuite.net/" +//					"videos/big_buck_bunny/bbb_448x252.mp4";			videoView.setVideoURI(Uri.parse(path));		} catch (IllegalStateException e) {			e.printStackTrace();		}		videoView.setOnPreparedListener(new OnPreparedListener() {			@Override			public void onPrepared(MediaPlayer asyncMediaPlayer) {				asyncMediaPlayer.start();				saveHistory("history", path);			}		});	}	/**	 * 把指定AutoCompleteTextView中内容保存到sharedPreference中指定的字符段	 * 	 * @param field	 *            保存在sharedPreference中的字段名	 * @param auto	 *            要操作的AutoCompleteTextView	 */	private void saveHistory(String field, String text) {		SharedPreferences sp = getSharedPreferences("video_url", 0);		String longhistory = sp.getString(field, "nothing");//		if(longhistory.equals("nothing"))return;		if (!longhistory.contains(text + ",")) {			StringBuilder sb = new StringBuilder(longhistory);			sb.insert(0, text + ",");			sp.edit().putString("history", sb.toString()).commit();		}	}	@Override	public boolean onKeyDown(int keyCode, KeyEvent event) {		if (keyCode == KeyEvent.KEYCODE_BACK) {			myMediaPlayer.stop();			myMediaPlayer.release();			this.finish();			return true;		}		return super.onKeyDown(keyCode, event);	}	@Override	public void onAudioFocusChange(int focusChange) {		// TODO Auto-generated method stub	}}